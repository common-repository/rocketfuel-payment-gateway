(()=>{let e={userAgreeToPartialPayment:()=>window.RocketfuelPaymentEngine.userAgreeToPartialPayment,showError:function(e){this.cart_resolve_object({type:"failure",message:e})},getUUID:async function(e=!0){let t=this.userData.first_name,a=this.userData.last_name,r=this.userData.email,n=wc_rkfl_context.start_block_checkout_url,c=`nonce=${wc_rkfl_context.start_checkout_nonce}&rkfl_checkout_firstname=${t}&rkfl_checkout_lastname=${a}&rkfl_checkout_email=${r}&rkfl_checkout_partial_tx_check=${e}`,s=await fetch(n,{method:"post",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c}),i={},l=await s.text();if(l)try{i=JSON.parse(l)}catch(o){i.messages=["Error parsing request"],console.error(" ERROR_PARSE_GUUID",{error:o})}if(!i.success){var m=i.data?i.data.messages:i.messages;return m||(m="Gateway request error"),this.showError(m.toString()),null}let u=i.data?.ext?.result?.uuid;return!!u&&{...i.data,uuid:u}},paymentData:{status:"wc-on-hold"},update_order:function(e){try{let t="wc-on-hold";if(e?.status===void 0)return!1;let a=parseInt(e.status);101===a&&(t="wc-partial-payment"),1===a&&(t=document.querySelector("input[name=payment_complete_order_status]")?.value||"wc-processing"),-1===a&&(t="wc-failed"),localStorage.setItem("payment_status_rocketfuel","complete")}catch(r){console.error("Error from update order method",r)}},initRocketFuel:async function(){let e=this;return new Promise(async(t,a)=>{e.window_listener();let r=await this.getUUID(),n=r.uuid;if(n||a(),r.isPartial){let c=await this.userAgreeToPartialPayment();c||(n=(r=await this.getUUID()).uuid)}window.RKFLBlockBasedObject.access_token=r?.ext?.access_token;let s={first_name:e.userData.first_name,last_name:e.userData.last_name,email:e.userData.email,merchant_auth:r.merchant_auth,encrypted_req:r.encrypted_req},i;if(window.RKFLBlockBasedObject.rkfl=new RocketFuel({environment:window.RKFLBlockBasedObject.environment}),window.RKFLBlockBasedObject.rkflConfig={uuid:n,callback:window.RKFLBlockBasedObject.update_order,environment:window.RKFLBlockBasedObject.environment},s.encrypted_req||s.first_name&&s.email){let l={encryptedReq:s.encrypted_req,merchantAuth:s.merchant_auth,email:s.email};try{if(console.log({payload:l}),!(i=localStorage.getItem("rkfl_token"))&&l.merchantAuth){l.accessToken=window.RKFLBlockBasedObject.access_token,l.isSSO=!0;let o=await window.RKFLBlockBasedObject.rkfl.rkflAutoSignUp(l,window.RKFLBlockBasedObject.environment);o&&(i=o.result?.rkflToken)}i&&(window.RKFLBlockBasedObject.rkflConfig.token=i),t(!0)}catch(m){a(m?.message)}}window.RKFLBlockBasedObject.rkflConfig?(window.RKFLBlockBasedObject.rkfl=new RocketFuel(window.RKFLBlockBasedObject.rkflConfig),e.startPayment(),t(!0)):t(!1)})},environment:"prod",cart_resolve_object:null,cart_reject_object:null,window_listener:function(e){let t=this;window.addEventListener("message",e=>{switch(e.data.type){case"rocketfuel_iframe_close":try{window.document.getElementById("iframeWrapper").style.display="none"}catch(a){}1===e.data.paymentCompleted?t.cart_resolve_object({type:"success",message:"Payment complete"}):t.cart_resolve_object({type:"failure",message:"Payment canceled"});break;case"rocketfuel_new_height":case"rocketfuel_result_ok":if(e.data.response){try{window.document.getElementById("iframeWrapper").style.display="none"}catch(r){}t.paymentResponse=e.data.response,t.update_order(t.paymentResponse)}}})},startPayment:function(){let e=setInterval(()=>{window.RKFLBlockBasedObject.rkfl.iframeInfo.iframe&&(window.RKFLBlockBasedObject.rkfl.initPayment(),clearInterval(e))},500)},init:async function({resolve:e,reject:t,billing:a,environment:r}){let n=this;return n.cart_reject_object=e=>{t(e)},n.cart_resolve_object=t=>{e(t)},n.environment=r,n.userData={first_name:a.billingData.first_name,last_name:a.billingData.last_name,email:a.billingData.email},new Promise(async(e,t)=>{try{await n.initRocketFuel()}catch(a){n.cart_resolve_object({type:"failure",message:"Error initiating payment"})}e()})}};window.RKFLBlockBasedObject=e})(),(()=>{"use strict";let{React:e,wc:{wcBlocksRegistry:t,wcSettings:a},wp:{i18n:r,htmlEntities:n}}=window,c=({title:e})=>n.decodeEntities(e)||(0,r.__)("Rocketfuel","woo-rocketfuel_gateway"),s=({description:e})=>n.decodeEntities(e||""),i=t=>{let{onPaymentSetup:a}=t.eventRegistration;return e.useEffect(()=>{let e=a(async()=>{let e=await new Promise(async(e,a)=>{console.log({billing:t.billing,environment:t.environment}),window.RKFLBlockBasedObject.init({resolve:e,reject:a,billing:t.billing,environment:t.environment})});return e});return e},[a]),n.decodeEntities(t.description||"")},l=a.getSetting("rocketfuel_gateway_data",{}),o=c({title:l.title}),m=s({description:l.button_text}),u={name:"rocketfuel_gateway",label:(0,e.createElement)(({title:t})=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{style:{display:"flex",flexDirection:"row",gap:"0.5rem"}},(0,e.createElement)("div",null,c({title:t})))),{title:o}),content:(0,e.createElement)(i,{description:l.description,environment:l.environment}),edit:e.createElement(s,{description:l.description}),canMakePayment:e=>!0,ariaLabel:o,supports:{features:l.supports},placeOrderButtonLabel:m};t.registerPaymentMethod(u)})();